<?xml version="1.0" encoding="UTF-8"?>
<iotgeneral:MultiSystem
    xmi:version="2.0"
    xmlns:xmi="http://www.omg.org/XMI"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:iotarduino="http://johnbrown.me/iotsysarduino2"
    xmlns:iotgeneral="http://johnbrown.me/iotsysgeneral2"
    xsi:schemaLocation="http://johnbrown.me/iotsysarduino2 http://johnbrown.me/swdata2#//IoTarduino http://johnbrown.me/iotsysgeneral2 http://johnbrown.me/swdata2#//General"
    id="DomoHome">
  <systems id="SYS_01"
      description="Thermostat">
    <sensors
        xsi:type="iotarduino:Temperature"
        id="TS_01"
        description="DHT22"
        hasTemperature="true"
        hasHumidity="true"/>
    <actuators
        xsi:type="iotarduino:Relay"
        id="RL_01"
        description="Heater"
        channels="2"/>
    <controllers
        xsi:type="iotarduino:Arduino"
        id="ECU_01"
        description="UnoR3"
        dataStructures="//@dataStructures.0 //@dataStructures.1">
      <ports
          xsi:type="iotarduino:ArduinoPort"
          id="DhtBus"
          pins="//@systems.0/@controllers.0/@pins.0"/>
      <ports
          xsi:type="iotarduino:ArduinoPort"
          id="RelayCommand"
          pins="//@systems.0/@controllers.0/@pins.1"/>
      <pins
          xsi:type="iotarduino:ArduinoPin"
          id="dht_data"
          number="3"
          direction="bidirectional"/>
      <pins
          xsi:type="iotarduino:ArduinoPin"
          id="heater_cmd"
          number="2"/>
    </controllers>
    <adapters
        xsi:type="iotgeneral:SensorAdapter"
        id="TempSens"
        coding="one_wire"
        port="//@systems.0/@controllers.0/@ports.0"
        sensor="//@systems.0/@sensors.0"
        controller="//@systems.0/@controllers.0"/>
    <adapters
        xsi:type="iotgeneral:ActuatorAdapter"
        id="RelayDriver"
        port="//@systems.0/@controllers.0/@ports.1"
        actuator="//@systems.0/@actuators.0"
        controller="//@systems.0/@controllers.0"/>
    <adapters
        xsi:type="iotgeneral:NetworkAdapter"
        id="TempSend"
        controller="//@systems.0/@controllers.0"
        data="//@dataStructures.0"/>
    <adapters
        xsi:type="iotgeneral:NetworkAdapter"
        id="CmdRcv"
        controller="//@systems.0/@controllers.0"
        data="//@dataStructures.1"
        direction="downlink"/>
  </systems>
  <systems id="SYS_02"
      description="CentralUnit">
    <sensors
        xsi:type="iotarduino:Keypad"
        id="KP_01"
        description="ControlPanel"
        buttons="4"/>
    <actuators
        xsi:type="iotarduino:Display"
        id="LCD_01"
        description="Display"
        lines="2"
        rows="16"/>
    <controllers
        xsi:type="iotarduino:Arduino"
        id="ECU_02"
        description="UnoR3"
        dataStructures="//@dataStructures.0 //@dataStructures.1">
      <ports
          xsi:type="iotarduino:ArduinoPort"
          id="KeypadPort"
          pins="//@systems.1/@controllers.0/@pins.0 //@systems.1/@controllers.0/@pins.1 //@systems.1/@controllers.0/@pins.2 //@systems.1/@controllers.0/@pins.3"/>
      <ports
          xsi:type="iotarduino:ArduinoPort"
          id="ExternalBus"
          pins="//@systems.1/@controllers.0/@pins.4 //@systems.1/@controllers.0/@pins.5"/>
      <pins
          xsi:type="iotarduino:ArduinoPin"
          id="btn_1"
          number="2"
          direction="input"/>
      <pins
          xsi:type="iotarduino:ArduinoPin"
          id="btn_2"
          number="3"
          direction="input"/>
      <pins
          xsi:type="iotarduino:ArduinoPin"
          id="btn_3"
          number="4"
          direction="input"/>
      <pins
          xsi:type="iotarduino:ArduinoPin"
          id="btn_4"
          number="5"
          direction="input"/>
      <pins
          xsi:type="iotarduino:ArduinoPin"
          id="i2c_sda"
          number="6"
          direction="bidirectional"/>
      <pins
          xsi:type="iotarduino:ArduinoPin"
          id="i2c_scl"
          number="7"/>
    </controllers>
    <adapters
        xsi:type="iotgeneral:SensorAdapter"
        id="KeypadInterface"
        port="//@systems.1/@controllers.0/@ports.0"
        sensor="//@systems.1/@sensors.0"
        controller="//@systems.1/@controllers.0"/>
    <adapters
        xsi:type="iotgeneral:ActuatorAdapter"
        id="DisplayInterface"
        coding="i2c"
        port="//@systems.1/@controllers.0/@ports.1"
        actuator="//@systems.1/@actuators.0"
        controller="//@systems.1/@controllers.0"/>
    <adapters
        xsi:type="iotgeneral:NetworkAdapter"
        id="CmdSend"
        controller="//@systems.1/@controllers.0"
        data="//@dataStructures.1"/>
    <adapters
        xsi:type="iotgeneral:NetworkAdapter"
        id="TempRcv"
        controller="//@systems.1/@controllers.0"
        data="//@dataStructures.0"
        direction="downlink"/>
  </systems>
  <networks
      id="CmdLink"
      adapters="//@systems.0/@adapters.3 //@systems.1/@adapters.2"/>
  <networks
      id="TempLink"
      adapters="//@systems.0/@adapters.2 //@systems.1/@adapters.3"/>
  <dataStructures
      id="TempData"
      description="Data Structure for temperature exchange">
    <fields
        name="temperature"
        type="float"/>
    <fields
        name="humidity"
        type="float"/>
  </dataStructures>
  <dataStructures
      id="CmdData"
      description="Data Structure for remote control">
    <fields
        name="command"
        type="int"/>
  </dataStructures>
</iotgeneral:MultiSystem>
